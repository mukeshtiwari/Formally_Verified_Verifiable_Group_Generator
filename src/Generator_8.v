Require Import Coq.NArith.NArith
  Verigen.Domainpar
  Znumtheory Lia
  Zdiv Zpow_facts.
From Coq Require Import String Ascii.
Open Scope N_scope.




(* 2048 bit prime*)

Module Pins <: Prime. 

Definition p : N := 0xf5c64916056e2b8ad54fcbbb538c1c465d31de879bbb4de61b97686865c7d14bd21ef666d407dc85c3441dcdc302d8ecdf50059e8241e9e88471d9415e92aeb14d6cc1f8f34a2d6b2645d5f720798b86e7f62e2ee8a6b39d6bb80c9dcbe57e0524695323c3e96c4bcc2c66624928aaf22f3bf9cda0954b3b5139adbd3903b64bbc8f364cee4b183c971809113a3f9e92c45103cb5acff636deaccf8638d6f9ca02125a421488123edebcf02d57a5cd8496ca6598800eedd823eaff0228560e223744061fae5232dc2282e4907410ca30c2785dcd68561478441a65f4539f8d475ca1dc7e28e1fbc294adf104163ca1fcdef64e2e5c0c877b46c3404949b5dad1.
Definition q : N := 0xb60a30151b6751097f64178ad3f863359b4c85b53b025587b84369d622c35fb3.
Definition domain_parameter_seed : N := 0x6949f9a67cc9b435383bd94c2afd04b87b7c3a4a7187ceae5bc58ba3700ef96c.
Definition index : N := 0x59.
Definition k : N := Eval vm_compute in N.div (p - 1) q.
Definition ggen : N := 0x6767656e.



Theorem prime_p : prime (Z.of_N p).
Proof.
Admitted.

Theorem p_len : 1024 <= N.size p.
Proof.
  simpl. lia.
Qed.

Theorem prime_q : prime (Z.of_N q).
Proof.
Admitted.

Theorem q_len : 160 <= N.size q.
Proof.
  simpl. lia.
Qed.

Theorem k_gteq_2 : 2 <= k.
Proof.
  vm_compute; intro Hf.
  inversion Hf.
Qed.

Theorem safe_prime : p = k * q + 1.
Proof.
  vm_compute.
  reflexivity.
Qed.

Theorem ggen_hyp : ggen =  0x6767656e.
Proof.
  unfold ggen.
  reflexivity.
Qed.

Theorem index_8bit : 0 <= index < 255.
Proof.
  vm_compute.
  split.
  intros Hf; inversion Hf.
  reflexivity.
Qed.


End Pins.


(* get a concrete instance *)
Module genr := Comp Pins.

Definition G : N := 0xf432a19d1cc565eca8cf4f67ad3f131fe72ddff64fcf446416aeb526d3ba4f2207316b111d14d03ac74aeab691b5c56614991589ef2d3fee4735841d3b70bb88fac020d951641ad05d433600e4dd5a342c051821c837e274f4290a16019d2ee1d149b3ba0745713be25893037fb5fbf1e93ab2a79344e8c286dd8ceb36449b1b24fa5762a9892009625e4983c2f8ac03712b50117da4aa4998f69bb3d99412608b9db6d5e40938e53d3f63bd8cbff2ff94c6fd6ad9419ccb85e4722360077dc67abf8734859eb7abb02a3d16f21c85569ccfc0efd2e67ee2c1404bbcd105b01d4d0e24b2e8be2a1a3137db22e17d9910dc4e03fce11f88b26ebf4589a69f793b.


Theorem G_is_gen : genr.Valid G = genr.compute_generator.
Proof.
  Time vm_compute.
  reflexivity.
Qed.

Time Eval vm_compute in genr.compute_generator.

(*
Finished transaction in 412.261 secs (409.286u,2.617s) (successful)
	 = genr.Valid
         30827113638062155707616269302531551119452708162605460531443522853399265094233230090236106474498610375088818881076937033907305380556951808525873535920749157105046303837536400957943237319508356497271947437278408440860865578536217653463247439380042444965023833640988275702519504511399551304181130117912437679538658396981265574932497402871300874163564126307709025599418598053644899380489152058952873644130199699802630122529043373387575803101121529968419553822680328682440160187107789650220640886602154339302225594385286571930972897568894793232717531235783992916417706832642343335576285265690498010286215611726811463907643
     : genr.Tag
Finished transaction in 0.355 secs (0.349u,0.004s) (successful)

*)

Time Eval vm_compute in (genr.verify_generator 30827113638062155707616269302531551119452708162605460531443522853399265094233230090236106474498610375088818881076937033907305380556951808525873535920749157105046303837536400957943237319508356497271947437278408440860865578536217653463247439380042444965023833640988275702519504511399551304181130117912437679538658396981265574932497402871300874163564126307709025599418598053644899380489152058952873644130199699802630122529043373387575803101121529968419553822680328682440160187107789650220640886602154339302225594385286571930972897568894793232717531235783992916417706832642343335576285265690498010286215611726811463907643).

(*
 = true
     : bool
Finished transaction in 491.748 secs (489.539u,1.914s) (successful)

*)