Require Import Coq.NArith.NArith
  Verigen.Domainpar
  Znumtheory Lia
  Zdiv Zpow_facts.
From Coq Require Import String Ascii.
Open Scope N_scope.





(* 2048 bit prime*)

Module Pins <: Prime. 

Definition p : N := 0xd765e6c1c37929394d1a414cb7fe96bd43cf753e0567581b4297ce9d80d8c3362337b310cecf218b403cd75ad2056c5b550b92d94b91f7ffa2d9d22326abfafe08646366278b4ab577e53343c5750af08d35cbeae4eabd7fb592a501bedeeb65126f0a68e41a66ee98a128319720abfc615bce55c32bb92f7b244859cde3bdb19cb086e9154fc8793b6f165244621171077f14b84ac033e24dd1254ded07687573129150143745bca792c11ddb09aa0806945f55cc6f0449b70cd104b2e0f3b34cb6278a9d7aedb6336898edf313e4c243362e6e2e61101a831a97b3372c618393a64661812eae6cb3529f29c2ee9d9984e83e603a1df30a26e9a5ff74b46a91.
Definition q : N := 0xb60c906fd1e5d262b81f63dd5f519aaae1e5cc86773844d99b958ee0e1f20ed5.
Definition domain_parameter_seed : N := 0x338476c695641255d48e05cdc2857917de31ce70ceb7b93009ea2a8ef67aff8d.
Definition index : N := 0x18.
Definition k : N := Eval vm_compute in N.div (p - 1) q.
Definition ggen : N := 0x6767656e.



Theorem prime_p : prime (Z.of_N p).
Proof.
Admitted.

Theorem p_len : 1024 <= N.size p.
Proof.
  simpl. lia.
Qed.

Theorem prime_q : prime (Z.of_N q).
Proof.
Admitted.

Theorem q_len : 160 <= N.size q.
Proof.
  simpl. lia.
Qed.

Theorem k_gteq_2 : 2 <= k.
Proof.
  vm_compute; intro Hf.
  inversion Hf.
Qed.

Theorem safe_prime : p = k * q + 1.
Proof.
  vm_compute.
  reflexivity.
Qed.

Theorem ggen_hyp : ggen =  0x6767656e.
Proof.
  unfold ggen.
  reflexivity.
Qed.

Theorem index_8bit : 0 <= index < 255.
Proof.
  vm_compute.
  split.
  intros Hf; inversion Hf.
  reflexivity.
Qed.


End Pins.


(* get a concrete instance *)
Module genr := Comp Pins.

Definition G : N := 0x842e3c45311006cab85619dd9a2c2d77d6bf8abd4155e109954a1222b4bdf2966a6c48c5a322be215a1d265a7458d46acadeacc8f710a6e84e7b327b7edc944ac7dbaabbb8a00b8321a2081c8fdce438ed2ec936557ad2bd173e8199069316e4deba50dde9925b0e125ebff14ad7f04bf92fe5b7436a283f6157f29e51b3f3bc34d98da1734a8b42520b6946c9caa77e8f5f64eff71e295367a7faa85bdc93f157eea9a12e46fab870dc573cf519837a729921ab454c6fef15e8c3ce70b5d8e8a6fa2e5cc8cad0794cce0171c53f729da5766f585dca0ce7d62b6bd565d3def344680df4bf4cdf3c257b9ae7e86e5028bbbefdca386ed902de7794a3061f7026.


Theorem G_is_gen : genr.Valid G = genr.compute_generator.
Proof.
  Time vm_compute.
  reflexivity.
Qed.

Time Eval vm_compute in genr.compute_generator.

(*
Finished transaction in 416.805 secs (414.876u,1.627s) (successful)
	 = genr.Valid
         16686255796188270469452539079851735482599464970095728845376833175044739122871243427199534360628114649000541180209352807279464906205869949161498141911328904969470630729113553098750547922591310704595028004997153534924113212998484168331949285437631969721323791545627286096124025385227828302583519400718140112333266887611575180549759041245944334854043622278279872761414635392575968374689231799056303753969701579382272273478745221727429281144967043356266411949754822424536441553774980090741788351724931604116702476051827592394461684697135364574264113516123841060846295360996479772006006264947007196630074887221145679917094
     : genr.Tag
Finished transaction in 411.102 secs (407.507u,3.101s) (successful)

*)

Time Eval vm_compute in (genr.verify_generator 16686255796188270469452539079851735482599464970095728845376833175044739122871243427199534360628114649000541180209352807279464906205869949161498141911328904969470630729113553098750547922591310704595028004997153534924113212998484168331949285437631969721323791545627286096124025385227828302583519400718140112333266887611575180549759041245944334854043622278279872761414635392575968374689231799056303753969701579382272273478745221727429281144967043356266411949754822424536441553774980090741788351724931604116702476051827592394461684697135364574264113516123841060846295360996479772006006264947007196630074887221145679917094).

(*
 = true
     : bool
Finished transaction in 492.144 secs (488.355u,3.653s) (successful)

*)